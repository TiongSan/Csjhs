<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°èª Spot It éŠæˆ²</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Iansui&family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Iansui', 'Noto Sans TC', Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: white;
      font-size: 2.5em;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .game-info {
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    .score-time {
      display: flex;
      justify-content: space-around;
      font-size: 1.5em;
      font-weight: bold;
      color: #333;
    }
    
    .cards-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 40px 0;
      flex-wrap: wrap;
    }
    
    .card {
      width: 320px;
      height: 320px;
      border-radius: 15px;
      background: white;
      border: 8px solid #4a90e2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      position: relative;
    }
    
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }
    
    .card.playing {
      border-color: #f39c12;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .card-symbols {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 8px;
      width: 90%;
      height: 90%;
      padding: 15px;
    }
    
    .card-symbols .symbol:nth-child(5) {
      visibility: hidden;
    }
    
    .symbol {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(74, 144, 226, 0.1);
      border-radius: 10px;
      padding: 5px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .symbol:hover {
      background: rgba(74, 144, 226, 0.2);
      transform: scale(1.1);
    }
    
    .symbol.found {
      background: rgba(46, 204, 113, 0.3);
      border: 2px solid #2ecc71;
    }
    
    .chinese-word {
      font-size: 1.1em;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 1px;
    }
    
    .roma-text {
      font-size: 0.75em;
      color: #7f8c8d;
      font-style: italic;
    }
    
    .controls {
      margin: 30px 0;
    }
    
    .btn {
      background: #4a90e2;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.2em;
      border-radius: 25px;
      cursor: pointer;
      margin: 0 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
    }
    
    .btn:hover {
      background: #357abd;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
    }
    
    .btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .message {
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      font-size: 1.3em;
      color: #2c3e50;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .success {
      background: rgba(46, 204, 113, 0.9);
      color: white;
    }
    
    .error {
      background: rgba(231, 76, 60, 0.9);
      color: white;
    }
    
    .browse-controls {
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .single-card-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    
    #cardInfo {
      font-size: 1.2em;
      font-weight: bold;
      color: #2c3e50;
      min-width: 120px;
      text-align: center;
    }
    
    .instructions {
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: left;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .instructions h3 {
      color: #2c3e50;
      margin-top: 0;
    }
    
    .instructions ul {
      color: #34495e;
      line-height: 1.6;
    }
    
    .hint-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #e67e22;
      color: white;
      border: none;
      padding: 15px 25px;
      font-size: 1.1em;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3);
      z-index: 1000;
    }
    
    .hint-btn:hover {
      background: #d35400;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(230, 126, 34, 0.4);
    }
    
    .hint-btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .symbol.hint {
      background: rgba(230, 126, 34, 0.3);
      border: 2px solid #e67e22;
      animation: hintPulse 1s ease-in-out 3;
    }
    
    @keyframes hintPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    
    @media (max-width: 768px) {
      .cards-container {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
      
      .card {
        width: 280px;
        height: 280px;
      }
      
      .hint-btn {
        top: 10px;
        right: 10px;
        padding: 12px 20px;
        font-size: 1em;
      }
      
      .score-time {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="hint-btn" id="hintBtn" onclick="showHint()" disabled>ğŸ’¡ æç¤º</button>
    
    <h1>å°èª Spot It éŠæˆ²</h1>
    
    <div class="game-info">
      <div class="score-time">
        <div>åˆ†æ•¸: <span id="score">0</span></div>
        <div>æ™‚é–“: <span id="time">120</span>ç§’</div>
        <div>æ‰¾åˆ°: <span id="found">0</span> çµ„</div>
      </div>
    </div>
    
    <div class="controls">
      <button class="btn" id="startBtn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
      <button class="btn" id="newCardsBtn" onclick="generateNewCards()" disabled>æ›æ–°å¡ç‰‡</button>
      <button class="btn" id="playCard1Btn" onclick="playCardAudio(0)" disabled>æ’­æ”¾å·¦å¡éŸ³é »</button>
      <button class="btn" id="playCard2Btn" onclick="playCardAudio(1)" disabled>æ’­æ”¾å³å¡éŸ³é »</button>
      <button class="btn" id="browseBtn" onclick="toggleBrowseMode()">ç€è¦½æ‰€æœ‰å¡ç‰‡</button>
    </div>
    
    <div id="browseMode" style="display: none;">
      <div class="browse-controls">
        <button class="btn" onclick="previousCard()">ä¸Šä¸€å¼µ</button>
        <span id="cardInfo">å¡ç‰‡ 1 / 57</span>
        <button class="btn" onclick="nextCard()">ä¸‹ä¸€å¼µ</button>
        <button class="btn" onclick="playCurrentCardAudio()">æ’­æ”¾éŸ³é »</button>
      </div>
      <div class="single-card-container">
        <div class="card" id="browseCard">
          <div class="card-symbols" id="browse-card-symbols"></div>
        </div>
      </div>
    </div>
    
    <div id="message" class="message" style="display: none;"></div>
    
    <div class="cards-container">
      <div class="card" id="card1">
        <div class="card-symbols" id="card1-symbols"></div>
      </div>
      <div class="card" id="card2">
        <div class="card-symbols" id="card2-symbols"></div>
      </div>
    </div>
    
    <div class="instructions">
      <h3>éŠæˆ²è¦å‰‡ï¼š</h3>
      <ul>
        <li>æ¯å¼µå¡ç‰‡æœ‰8å€‹å°èªè©å½™</li>
        <li>ä»»æ„å…©å¼µå¡ç‰‡ä¹‹é–“æ°å¥½æœ‰ä¸€å€‹ç›¸åŒçš„è©å½™</li>
        <li>é»æ“Šå¡ç‰‡æ’­æ”¾æ‰€æœ‰å°èªéŸ³é »</li>
        <li>æ‰¾åˆ°å…©å¼µå¡ç‰‡çš„å…±åŒè©å½™ä¸¦é»æ“Šå®ƒ</li>
        <li>æ‰¾å°äº†æœƒæ’­æ”¾è©²è©å½™çš„éŸ³é »ç¢ºèª</li>
        <li>åœ¨æ™‚é–“å…§æ‰¾åˆ°è¶Šå¤šçµ„åˆï¼Œåˆ†æ•¸è¶Šé«˜ï¼</li>
      </ul>
    </div>
  </div>

  <script>
    // å¾ audioSpotit.json è¼‰å…¥çš„57å€‹å°èªç¬¦è™Ÿ
    let selectedWords = [];

    // å®Œæ•´çš„57å¼µ Spot It å¡ç‰‡çµ„åˆ (æ¯å¼µ8å€‹ç¬¦è™Ÿï¼Œä»»æ„å…©å¼µæ°å¥½1å€‹å…±åŒç¬¦è™Ÿ)
    // åŸºæ–¼æœ‰é™å°„å½±å¹³é¢ PG(2,7) çš„æ•¸å­¸çµæ§‹ï¼š57å€‹ç¬¦è™Ÿï¼Œ57å¼µå¡ç‰‡ï¼Œæ¯å¼µ8å€‹ç¬¦è™Ÿ
    const spotItCards = [
      [0,1,2,3,4,5,6,7], [0,8,9,10,11,12,13,14], [0,15,16,17,18,19,20,21], [0,22,23,24,25,26,27,28],
      [0,29,30,31,32,33,34,35], [0,36,37,38,39,40,41,42], [0,43,44,45,46,47,48,49], [0,50,51,52,53,54,55,56],
      [1,8,15,22,29,36,43,50], [1,9,16,23,30,37,44,51], [1,10,17,24,31,38,45,52], [1,11,18,25,32,39,46,53],
      [1,12,19,26,33,40,47,54], [1,13,20,27,34,41,48,55], [1,14,21,28,35,42,49,56], [2,8,16,24,32,40,48,56],
      [2,9,17,25,33,41,49,50], [2,10,18,26,34,42,43,51], [2,11,19,27,35,36,44,52], [2,12,20,28,29,37,45,53],
      [2,13,21,22,30,38,46,54], [2,14,15,23,31,39,47,55], [3,8,17,26,35,37,46,55], [3,9,18,27,29,38,47,56],
      [3,10,19,28,30,39,48,50], [3,11,20,22,31,40,49,51], [3,12,21,23,32,41,43,52], [3,13,15,24,33,42,44,53],
      [3,14,16,25,34,36,45,54], [4,8,18,28,31,41,44,54], [4,9,19,22,32,42,45,55], [4,10,20,23,33,36,46,56],
      [4,11,21,24,34,37,47,50], [4,12,15,25,35,38,48,51], [4,13,16,26,29,39,49,52], [4,14,17,27,30,40,43,53],
      [5,8,19,23,34,38,49,53], [5,9,20,24,35,39,43,54], [5,10,21,25,29,40,44,55], [5,11,15,26,30,41,45,56],
      [5,12,16,27,31,42,46,50], [5,13,17,28,32,36,47,51], [5,14,18,22,33,37,48,52], [6,8,20,25,30,42,47,52],
      [6,9,21,26,31,36,48,53], [6,10,15,27,32,37,49,54], [6,11,16,28,33,38,43,55], [6,12,17,22,34,39,44,56],
      [6,13,18,23,35,40,45,50], [6,14,19,24,29,41,46,51], [7,8,21,27,33,39,45,51], [7,9,15,28,34,40,46,52],
      [7,10,16,22,35,41,47,53], [7,11,17,23,29,42,48,54], [7,12,18,24,30,36,49,55], [7,13,19,25,31,37,43,56],
      [7,14,20,26,32,38,44,50]
    ];

    // è¼‰å…¥éŸ³é »è³‡æ–™
    async function loadAudioData() {
      try {
        const response = await fetch('audioSpotit.json');
        const data = await response.json();
        selectedWords = data;
        console.log('å·²è¼‰å…¥57å€‹å°èªç¬¦è™Ÿ:', selectedWords);
        preloadAudio();
        updateDisplay();
        generateNewCards();
      } catch (error) {
        console.error('ç„¡æ³•è¼‰å…¥éŸ³é »è³‡æ–™:', error);
        showMessage('ç„¡æ³•è¼‰å…¥éŸ³é »è³‡æ–™ï¼Œè«‹æª¢æŸ¥ audioSpotit.json æª”æ¡ˆ', 'error');
      }
    }

    let gameActive = false;
    let score = 0;
    let timeLeft = 120;
    let timer;
    let currentCards = [];
    let foundPairs = 0;
    let selectedSymbol = null;
    let audioCache = {};
    let allCards = []; // å­˜å„²æ‰€æœ‰57å¼µå¡ç‰‡
    let currentCardIndex = 0;

    // é è¼‰å…¥éŸ³é »
    function preloadAudio() {
      if (selectedWords.length === 0) return;
      
      selectedWords.forEach(word => {
        const audio = new Audio(word.addr);
        audio.preload = 'auto';
        audioCache[word.word] = audio;
      });
      console.log('éŸ³é »é è¼‰å…¥å®Œæˆ');
    }

    // æ’­æ”¾éŸ³é »
    function playAudio(word) {
      if (audioCache[word]) {
        audioCache[word].currentTime = 0;
        audioCache[word].play().catch(e => console.log('éŸ³é »æ’­æ”¾å¤±æ•—:', e));
      } else {
        console.log('æ‰¾ä¸åˆ°éŸ³é »:', word);
      }
    }

    // ç”Ÿæˆæ–°çš„å¡ç‰‡çµ„åˆ
    function generateNewCards() {
      if (selectedWords.length === 0) {
        console.log('ç­‰å¾…éŸ³é »è³‡æ–™è¼‰å…¥...');
        return;
      }
      
      // éš¨æ©Ÿé¸æ“‡å…©å¼µä¸åŒçš„å¡ç‰‡
      const cardIndex1 = Math.floor(Math.random() * spotItCards.length);
      let cardIndex2 = Math.floor(Math.random() * spotItCards.length);
      while (cardIndex2 === cardIndex1) {
        cardIndex2 = Math.floor(Math.random() * spotItCards.length);
      }
      
      currentCards = [spotItCards[cardIndex1], spotItCards[cardIndex2]];
      renderCards();
      clearFoundSymbols();
      
      // é¡¯ç¤ºå¡ç‰‡è³‡è¨Š
      console.log(`å¡ç‰‡1 (${cardIndex1}):`, currentCards[0].map(i => selectedWords[i]?.word));
      console.log(`å¡ç‰‡2 (${cardIndex2}):`, currentCards[1].map(i => selectedWords[i]?.word));
      
      // æ‰¾å‡ºå…±åŒç¬¦è™Ÿ
      const commonSymbol = findCommonSymbol(currentCards[0], currentCards[1]);
      if (commonSymbol !== -1) {
        console.log('å…±åŒç¬¦è™Ÿ:', selectedWords[commonSymbol]?.word);
      }
    }

    // æ‰¾å‡ºå…©å¼µå¡ç‰‡çš„å…±åŒç¬¦è™Ÿ
    function findCommonSymbol(card1, card2) {
      for (let symbol1 of card1) {
        for (let symbol2 of card2) {
          if (symbol1 === symbol2) {
            return symbol1;
          }
        }
      }
      return -1; // ç†è«–ä¸Šä¸æ‡‰è©²ç™¼ç”Ÿ
    }

    // æ¸²æŸ“å¡ç‰‡
    function renderCards() {
      currentCards.forEach((card, cardIndex) => {
        const cardElement = document.getElementById(`card${cardIndex + 1}-symbols`);
        cardElement.innerHTML = '';
        
        card.forEach((symbolIndex, index) => {
          const word = selectedWords[symbolIndex];
          const symbolElement = document.createElement('div');
          symbolElement.className = 'symbol';
          symbolElement.innerHTML = `
            <div class="chinese-word">${word.word}</div>
            <div class="roma-text">${word.roma}</div>
          `;
          symbolElement.onclick = () => selectSymbol(symbolIndex, cardIndex, symbolElement);
          cardElement.appendChild(symbolElement);
          
          // åœ¨ç¬¬4å€‹ä½ç½®å¾Œæ’å…¥ç©ºæ ¼ï¼ˆè®“ç¬¬5æ ¼æ˜¯ç©ºçš„ï¼‰
          if (index === 3) {
            const emptyElement = document.createElement('div');
            emptyElement.className = 'symbol';
            emptyElement.style.visibility = 'hidden';
            cardElement.appendChild(emptyElement);
          }
        });
      });
    }

    // é¸æ“‡ç¬¦è™Ÿ
    function selectSymbol(symbolIndex, cardIndex, element) {
      if (!gameActive) return;
      
      const word = selectedWords[symbolIndex].word;
      
      if (selectedSymbol === null) {
        selectedSymbol = {symbolIndex, cardIndex, element, word};
        element.style.background = 'rgba(241, 196, 15, 0.3)';
        element.style.border = '2px solid #f1c40f';
        playAudio(word);
      } else {
        if (selectedSymbol.symbolIndex === symbolIndex && selectedSymbol.cardIndex !== cardIndex) {
          // æ‰¾åˆ°åŒ¹é…ï¼
          selectedSymbol.element.classList.add('found');
          element.classList.add('found');
          
          score += 10;
          foundPairs++;
          updateDisplay();
          
          playAudio(word);
          showMessage(`å¤ªå¥½äº†ï¼æ‰¾åˆ°å…±åŒè©å½™ï¼š${word}`, 'success');
          
          setTimeout(() => {
            generateNewCards();
          }, 2000);
          
        } else {
          // æ²’æœ‰åŒ¹é…
          selectedSymbol.element.style.background = '';
          selectedSymbol.element.style.border = '';
          playAudio(word);
          showMessage(`é€™ä¸æ˜¯å…±åŒè©å½™ï¼Œå†è©¦è©¦çœ‹ï¼`);
        }
        selectedSymbol = null;
      }
    }

    // æ’­æ”¾å¡ç‰‡æ‰€æœ‰éŸ³é »
    function playCardAudio(cardIndex) {
      if (!gameActive || !currentCards[cardIndex]) return;
      
      const card = document.getElementById(`card${cardIndex + 1}`);
      card.classList.add('playing');
      
      let audioIndex = 0;
      const playNext = () => {
        if (audioIndex < currentCards[cardIndex].length) {
          const word = selectedWords[currentCards[cardIndex][audioIndex]].word;
          playAudio(word);
          audioIndex++;
          setTimeout(playNext, 1500); // æ¯å€‹éŸ³é »é–“éš”1.5ç§’
        } else {
          card.classList.remove('playing');
        }
      };
      
      playNext();
    }

    // æ¸…é™¤æ‰¾åˆ°çš„ç¬¦è™Ÿæ¨™è¨˜
    function clearFoundSymbols() {
      document.querySelectorAll('.symbol').forEach(symbol => {
        symbol.classList.remove('found');
        symbol.style.background = '';
        symbol.style.border = '';
      });
      selectedSymbol = null;
    }

    // é¡¯ç¤ºè¨Šæ¯
    function showMessage(text, type = '') {
      const messageElement = document.getElementById('message');
      messageElement.textContent = text;
      messageElement.className = `message ${type}`;
      messageElement.style.display = 'block';
      
      setTimeout(() => {
        messageElement.style.display = 'none';
      }, 3000);
    }

    // æ›´æ–°é¡¯ç¤º
    function updateDisplay() {
      document.getElementById('score').textContent = score;
      document.getElementById('time').textContent = timeLeft;
      document.getElementById('found').textContent = foundPairs;
    }

    // é–‹å§‹éŠæˆ²
    function startGame() {
      gameActive = true;
      score = 0;
      foundPairs = 0;
      timeLeft = 120;
      
      document.getElementById('startBtn').disabled = true;
      document.getElementById('newCardsBtn').disabled = false;
      document.getElementById('playCard1Btn').disabled = false;
      document.getElementById('playCard2Btn').disabled = false;
      document.getElementById('hintBtn').disabled = false;
      
      updateDisplay();
      generateNewCards();
      
      timer = setInterval(() => {
        timeLeft--;
        updateDisplay();
        
        if (timeLeft <= 0) {
          endGame();
        }
      }, 1000);
      
      showMessage('éŠæˆ²é–‹å§‹ï¼æ‰¾å‡ºå…©å¼µå¡ç‰‡çš„å…±åŒè©å½™å§ï¼', 'success');
    }

    // çµæŸéŠæˆ²
    function endGame() {
      gameActive = false;
      clearInterval(timer);
      
      document.getElementById('startBtn').disabled = false;
      document.getElementById('newCardsBtn').disabled = true;
      document.getElementById('playCard1Btn').disabled = true;
      document.getElementById('playCard2Btn').disabled = true;
      document.getElementById('hintBtn').disabled = true;
      
      showMessage(`éŠæˆ²çµæŸï¼æœ€çµ‚åˆ†æ•¸ï¼š${score} åˆ†ï¼Œæ‰¾åˆ° ${foundPairs} çµ„é…å°ï¼`, 'success');
    }

    // ç€è¦½æ¨¡å¼ç›¸é—œåŠŸèƒ½
    let browseMode = false;
    let currentBrowseCard = 0;

    function toggleBrowseMode() {
      browseMode = !browseMode;
      const browseDiv = document.getElementById('browseMode');
      const cardsContainer = document.querySelector('.cards-container');
      const browseBtn = document.getElementById('browseBtn');
      
      if (browseMode) {
        browseDiv.style.display = 'block';
        cardsContainer.style.display = 'none';
        browseBtn.textContent = 'è¿”å›éŠæˆ²';
        currentBrowseCard = 0;
        renderBrowseCard();
      } else {
        browseDiv.style.display = 'none';
        cardsContainer.style.display = 'flex';
        browseBtn.textContent = 'ç€è¦½æ‰€æœ‰å¡ç‰‡';
      }
    }

    function renderBrowseCard() {
      if (selectedWords.length === 0 || currentBrowseCard >= spotItCards.length) return;
      
      const card = spotItCards[currentBrowseCard];
      const cardElement = document.getElementById('browse-card-symbols');
      cardElement.innerHTML = '';
      
      card.forEach((symbolIndex, index) => {
        const word = selectedWords[symbolIndex];
        if (word) {
          const symbolElement = document.createElement('div');
          symbolElement.className = 'symbol';
          symbolElement.innerHTML = `
            <div class="chinese-word">${word.word}</div>
            <div class="roma-text">${word.roma}</div>
          `;
          symbolElement.onclick = () => playAudio(word.word);
          cardElement.appendChild(symbolElement);
          
          // åœ¨ç¬¬4å€‹ä½ç½®å¾Œæ’å…¥ç©ºæ ¼ï¼ˆè®“ç¬¬5æ ¼æ˜¯ç©ºçš„ï¼‰
          if (index === 3) {
            const emptyElement = document.createElement('div');
            emptyElement.className = 'symbol';
            emptyElement.style.visibility = 'hidden';
            cardElement.appendChild(emptyElement);
          }
        }
      });
      
      document.getElementById('cardInfo').textContent = `å¡ç‰‡ ${currentBrowseCard + 1} / ${spotItCards.length}`;
    }

    function previousCard() {
      if (currentBrowseCard > 0) {
        currentBrowseCard--;
        renderBrowseCard();
      }
    }

    function nextCard() {
      if (currentBrowseCard < spotItCards.length - 1) {
        currentBrowseCard++;
        renderBrowseCard();
      }
    }

    function playCurrentCardAudio() {
      if (selectedWords.length === 0 || currentBrowseCard >= spotItCards.length) return;
      
      const card = spotItCards[currentBrowseCard];
      const browseCard = document.getElementById('browseCard');
      browseCard.classList.add('playing');
      
      let audioIndex = 0;
      const playNext = () => {
        if (audioIndex < card.length) {
          const word = selectedWords[card[audioIndex]];
          if (word) {
            playAudio(word.word);
          }
          audioIndex++;
          setTimeout(playNext, 1500);
        } else {
          browseCard.classList.remove('playing');
        }
      };
      
      playNext();
    }

    // é¡¯ç¤ºæç¤ºåŠŸèƒ½
    function showHint() {
      if (!gameActive || currentCards.length < 2) return;
      
      // æ‰¾å‡ºå…±åŒç¬¦è™Ÿ
      const commonSymbol = findCommonSymbol(currentCards[0], currentCards[1]);
      if (commonSymbol === -1) return;
      
      const word = selectedWords[commonSymbol].word;
      
      // é«˜äº®é¡¯ç¤ºå…©å¼µå¡ç‰‡ä¸Šçš„å…±åŒç¬¦è™Ÿ
      document.querySelectorAll('.symbol').forEach(symbolElement => {
        const wordText = symbolElement.querySelector('.chinese-word')?.textContent;
        if (wordText === word) {
          symbolElement.classList.add('hint');
          setTimeout(() => {
            symbolElement.classList.remove('hint');
          }, 3000);
        }
      });
      
      // æ’­æ”¾éŸ³é »ä¸¦é¡¯ç¤ºè¨Šæ¯
      playAudio(word);
      showMessage(`æç¤ºï¼šå…±åŒè©å½™æ˜¯ã€Œ${word}ã€(${selectedWords[commonSymbol].roma})`, 'success');
      
      // æ‰£åˆ†æ‡²ç½°
      score = Math.max(0, score - 3);
      updateDisplay();
    }
    
    // é©—è­‰å¡ç‰‡çµ„åˆçš„æ­£ç¢ºæ€§
    function validateSpotItCards() {
      console.log('é©—è­‰ Spot It å¡ç‰‡çµ„åˆ...');
      let isValid = true;
      
      for (let i = 0; i < spotItCards.length; i++) {
        for (let j = i + 1; j < spotItCards.length; j++) {
          const commonSymbols = spotItCards[i].filter(symbol => spotItCards[j].includes(symbol));
          if (commonSymbols.length !== 1) {
            console.error(`å¡ç‰‡ ${i} å’Œå¡ç‰‡ ${j} æœ‰ ${commonSymbols.length} å€‹å…±åŒç¬¦è™Ÿ:`, commonSymbols);
            isValid = false;
          }
        }
      }
      
      if (isValid) {
        console.log('âœ… æ‰€æœ‰å¡ç‰‡çµ„åˆéƒ½æ­£ç¢ºï¼æ¯å°å¡ç‰‡æ°å¥½æœ‰1å€‹å…±åŒç¬¦è™Ÿ');
      } else {
        console.error('âŒ å¡ç‰‡çµ„åˆæœ‰å•é¡Œ');
      }
      
      return isValid;
    }

    // åˆå§‹åŒ–
    window.onload = function() {
      loadAudioData();
      // é©—è­‰å¡ç‰‡çµ„åˆ
      setTimeout(() => {
        if (selectedWords.length > 0) {
          validateSpotItCards();
        }
      }, 1000);
    };
  </script>
</body>
</html>