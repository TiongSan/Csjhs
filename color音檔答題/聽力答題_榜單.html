<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>色水測驗</title>
  <style>
    button {
      font-size: 24px;
      padding: 20px;
      width: 100%;
      height: 100px;
    }
    #options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 10px;
      width: 400px;
      margin: 20px auto;
    }
    body {
      text-align: center;
      display: flex;
    }
    #gameArea {
      flex: 1;
    }
    #leaderboard {
      width: 300px;
      padding: 20px;
      background-color: #f4f4f4;
      border-left: 2px solid #ccc;
    }
    .highlight {
      background-color: red;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <h1>色水測驗</h1>
    <button onclick="startGame()" style="font-size: 24px; padding: 15px; margin: 20px;">開始遊戲</button><br><br>
    <div id="options"></div>
    <div id="score" style="font-size: 24px;">Score: 0</div>
    <div id="time" style="font-size: 24px;">Time Left: 60</div>
  </div>

  <div id="leaderboard">
    <h2>前10名榜單</h2>
    <ol id="topPlayersList"></ol>
  </div>
<!-- 班級選擇與學生名單 -->
  <h2>選擇班級與學生</h2>
  <label for="classSelect">選擇班級：</label>
  <select id="classSelect" onchange="showStudents()">
    <option value="">請選擇班級</option>
    <option value="703">703班</option>
    <option value="705">705班</option>
    <option value="707">707班</option>
    <option value="708">708班</option>
    <option value="709">709班</option>
    <option value="801">801班</option>
    <option value="802">802班</option>
    <option value="803">803班</option>
    <option value="804">804班</option>
    <option value="805">805班</option>
    <option value="806">806班</option>
    <option value="807">807班</option>
    <option value="808">808班</option>
  </select>
   <br><br>
   <label for="studentSelect" class="hidden" id="studentLabel">選擇學生：</label>
  <select id="studentSelect" class="hidden">
    <option value="">請先選擇班級</option>
  </select>
   <br><br>
<button id="submitScore" class="hidden" onclick="submitScore()">送出成績</button>
  <!-- JavaScript 程式碼 -->
  <script>

        // 班級與學生對應資料
    const students = {
      '703': ['70301王怡絜', '70302王湘儀', '70304吳喬淇', '70305郭珈妤', '70306陳芊蓉', '70308黃苡榕', '70310蕭珮羽', '70311簡妍蓁', '70321吳杰叡', '70322李承陽'],
      '705': ['70501李若瑜', '70502計品如', '70503許舒涵', '70504陳又溱', '70505陳姵羽', '70506曾庭栩', '70507黃羽彤', '70509宋沛霖', '70510張晴晴', '70511劉韋妘'],
      '707': ['70701李彤澐', '70702李芊逸', '70703周佩穎', '70704康銛', '70705張硯柔', '70706陳采瑄', '70707陳映臻', '70708楊子萱', '70709楊芷喬', '70710鍾昀蓁'],
      '708': ['70801王奕涵', '70802王鑫', '70803朱晨瑄', '70804宋晴羽', '70805李沛辰', '70806張湘翎', '70807劉思妤', '70808潘秉潞', '70809蔡沛諭', '70810鄭晴允'],
      '709': ['70901林雨彤', '70902林雨詩', '70903邵楷晴', '70904徐詩媛', '70905莊羽恬', '70906黃子芮', '70907黃芃瑋', '70909樓光恕', '70910鄭向恩', '70921尤秉稐'],
      '801': ['80101李芃萱', '80102李宛頤', '80103李若昕', '80104林嘉盈', '80105陳又頡', '80106陳芃諺', '80107陳品妍', '80108陳宥潔', '80109陳韋彤', '80111葉禹彤'],
      '802': ['80202王靖', '80203吳易璇', '80204吳悠', '80205汪舒亞', '80206孟家亘', '80207林善慧', '80208韋智淩', '80210張語欣', '80211陳芃諭', '80212陳芮廷'],
      '803': ['80301方姿云', '80302王韵筑', '80303吳郁霏', '80304李畇蓁', '80305林以立', '80306林怡岑', '80307張惟甯', '80308陳姵听', '80310黃暄', '80311廖宥璇'],
      '804': ['80401李昕倪', '80402李若昀', '80403林汶玲', '80404林靖潔', '80405張佩琝', '80406張若羚', '80407陳芊佑', '80408陳采希', '80409陳品卉', '80410陳詠昕'],
      '805': ['80501伍幸恩', '80502李宜霏', '80503周芮榆', '80504邱淯琳', '80505張喆瑩', '80506陳宥芸', '80507陳弈菲', '80508黃玉晴', '80509黃歆晴', '80510葉宜芯'],
      '806': ['80601朱思佳', '80602吳亭侑', '80603李珮晴', '80604周若昀', '80606張少謙', '80607陳宜萱', '80608陳曉靚', '80609楊詠心', '80610詹詠善', '80611劉宇晴'],
      '807': ['80702古寓喬', '80703白雨橦', '80705林經娜', '80706洪恩僖', '80707洪嘉妤', '80708黃歆雅', '80709黃筱晶', '80711蔡岑希', '80712鄧詠心', '80713李羽恬'],
      '808': ['80801李沛恩', '80802李采潔', '80804唐嘉佑', '80805唐嘉彤', '80806徐韻凱', '80807高語萱', '80808郭玟慧', '80809陳希言', '80810黃以樂', '80811塗沂昀']
    };

    // 顯示對應班級的學生
    function showStudents() {
      const classSelect = document.getElementById('classSelect');
      const studentSelect = document.getElementById('studentSelect');
      const studentLabel = document.getElementById('studentLabel');
      const submitButton = document.getElementById('submitScore');
      
      const selectedClass = classSelect.value;

      // 如果選擇了班級，顯示對應的學生名單
      if (selectedClass) {
        studentLabel.classList.remove('hidden');
        studentSelect.classList.remove('hidden');
        submitButton.classList.remove('hidden');

        // 清空之前的選項
        studentSelect.innerHTML = '';

        // 添加新的學生選項
        const studentList = students[selectedClass];
        studentList.forEach(function(student) {
          const option = document.createElement('option');
          option.value = student;
          option.text = student;
          studentSelect.appendChild(option);
        });
      } else {
        studentLabel.classList.add('hidden');
        studentSelect.classList.add('hidden');
        submitButton.classList.add('hidden');
      }
    }

    // 提交成績
    function submitScore() {
      const selectedStudent = document.getElementById('studentSelect').value;
      if (selectedStudent) {
        alert('已選擇學生：' + selectedStudent);
        // 這裡可以加上將成績上傳到伺服器的邏輯
      } else {
        alert('請選擇學生');
      }
    }

    let audioFiles = ['咖啡色', '橙色', '灰色', '白色', '粉紅仔色', '紅色', '紫色', '膚色', '藍色', '青色', '黃色', '黑色'];
    let score = 0;
    let timeLeft = 60;
    let timer;
    let gameActive = false;

    window.onload = function() {
      fetchLeaderboard();  // 頁面載入時獲取榜單
    };

    function playRandomAudio() {
      if (!gameActive) return;
      let randomIndex = Math.floor(Math.random() * audioFiles.length);
      let audio = new Audio(audioFiles[randomIndex] + '.mp3');
      audio.play();
      let correctAnswer = audioFiles[randomIndex];
      let otherOptions = shuffleArray(audioFiles.filter(item => item !== correctAnswer));
      let allOptions = shuffleArray([correctAnswer, ...otherOptions.slice(0, 3)]);
      let optionsHtml = '';
      allOptions.forEach(option => {
        optionsHtml += `<button onclick="checkAnswer('${option === correctAnswer}')">${option}</button>`;
      });
      document.getElementById('options').innerHTML = optionsHtml;
    }

    function checkAnswer(isCorrect) {
      if (!gameActive) return;
      if (isCorrect === 'true') {
        score++;
      } else {
        score--;
        document.body.classList.add('highlight');  // 加入紅色背景
        setTimeout(() => {
          document.body.classList.remove('highlight');
        }, 500);
      }
      document.getElementById('score').innerText = 'Score: ' + score;
      playRandomAudio();
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function startGame() {
      gameActive = true;
      score = 0;
      timeLeft = 60;
      document.getElementById('score').innerText = 'Score: ' + score;
      document.getElementById('time').innerText = 'Time Left: ' + timeLeft;
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById('time').innerText = 'Time Left: ' + timeLeft;
        if (timeLeft === 0) endGame();
      }, 1000);
      playRandomAudio();
    }

    function endGame() {
      gameActive = false;
      clearInterval(timer);
      const playerName = prompt('請輸入您的名稱');
      if (!playerName) return;

      // 上傳分數到 Google 試算表
      fetch('https://script.google.com/macros/s/AKfycbzNH86W6EsP7MRfyZqmZ4ejKKf51Lfe_Fx020qLW__zHFxcDHThBD9h2KV_7fdGfnq7IA/exec/exec', {
        method: 'POST',
        body: JSON.stringify({ player: playerName, score: score })
      })
      .then(response => response.json())
      .then(data => {
        alert('遊戲結束！您的分數是: ' + score + '\n您的名次是: 第' + data.rank + '名');
        fetchLeaderboard();  // 更新前10名榜單
      })
      .catch(error => console.error('錯誤:', error));
    }

    function fetchLeaderboard() {
      fetch('https://script.google.com/macros/s/AKfycbzNH86W6EsP7MRfyZqmZ4ejKKf51Lfe_Fx020qLW__zHFxcDHThBD9h2KV_7fdGfnq7IA/exec/exec')
      .then(response => response.json())
      .then(data => {
        let topPlayersHtml = '';
        data.topPlayers.forEach(player => {
          topPlayersHtml += `<li>${player[0]}: ${player[1]} 分</li>`;
        });
        document.getElementById('topPlayersList').innerHTML = topPlayersHtml;
      })
      .catch(error => console.error('錯誤:', error));
    }
  </script>
</body>
</html>
