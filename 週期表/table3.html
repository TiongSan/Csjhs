<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å…ƒç´ é€±æœŸè¡¨æ»‘å¡Šæ‹¼åœ–ï¼ˆæ‰‹æ©Ÿ + è¿·éœ§ï¼‰</title>
  <style>
    :root{
      --cell-size: 48px;
      --gap: 2px;
    }
    body{
      font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
      background: #f5f7fa;
      text-align: center;
      color: #1f2937;
      /* å…è¨±åŸç”Ÿæ»¾å‹•ï¼ˆé¿å…é˜»æ­¢æ‰‹æ©Ÿæ»‘å‹•é é¢ï¼‰ */
      touch-action: auto;
      padding-bottom: env(safe-area-inset-bottom);
    }
    h1{ margin-top: 18px; font-size: 1.25rem; }
    #level-selection{ margin: 12px 0; }
    .level-btn{ padding:8px 12px; margin:0 6px; border-radius:6px; background:#6d28d9; color:#fff; border:2px solid transparent; cursor:pointer; }
    .level-btn.active{ background:#f5f7fa; color:#6d28d9; border-color:#6d28d9; font-weight:600; }
    #stats{ margin: 10px; font-weight:600; color:#374151; }
    #controls{ margin:8px 0; }
    #toggleLangBtn{ padding:6px 10px; border-radius:6px; background:#4f46e5; color:#fff; border:none; cursor:pointer; }
    #holding-bay-container{ margin:12px auto; padding:8px; background:#e5e7eb; border-radius:8px; display:flex; align-items:center; justify-content:center; width:220px; }
    #holding-bay-container span{ margin-right:10px; font-weight:700; }
    #holding-bay{ width:var(--cell-size); height:var(--cell-size); border:2px dashed #9ca3af; display:flex; align-items:center; justify-content:center; border-radius:6px; user-select:none; background:transparent; }
    #table{ display:grid; grid-template-columns: repeat(18, var(--cell-size)); grid-template-rows: repeat(4, var(--cell-size)); gap:var(--gap); justify-content:center; margin:10px auto; padding:6px; border:2px solid #d1d5db; background:#fff; border-radius:8px; width:max-content; }
    .cell{ display:flex; align-items:center; justify-content:center; border-radius:6px; font-weight:700; user-select:none; transition: all 160ms ease; box-shadow: 0 1px 3px rgba(0,0,0,0.06); min-width:var(--cell-size); min-height:var(--cell-size); }
    .cell.empty{ background:#e2e8f0; box-shadow: inset 0 2px 4px rgba(0,0,0,0.04); cursor: default; }
    .disabled{ background:#cbd5e1; cursor:not-allowed; box-shadow:none; }
    .metal{ background:#c7f9cc; } .nonmetal{ background:#fef08a; } .noble{ background:#a5f3fc; } .transition{ background:#fca5a5; }
    .clickable{ cursor:pointer; }
    .drag-over{ outline:2px dashed #6366f1; transform:scale(1.03); }
    /* è¿·éœ§æ¨£å¼ï¼šè¢«è¦†è“‹çš„æ ¼å­é¡¯ç¤ºå•è™Ÿä¸”æœ‰ä¸åŒèƒŒæ™¯ */
    .covered{ background:#d1d5db !important; color:#374151 !important; font-size:1.05rem; }
    .win-flash, .correct-place-flash{ animation: flash 0.48s ease-in-out; }
    @keyframes flash{ 0%{ box-shadow:0 0 14px #fef08a; transform:scale(1.04);} 100%{ box-shadow:0 1px 3px rgba(0,0,0,0.08); transform:scale(1);} }
    /* small helper for touch feedback */
    .touch-feedback{ transform: translateY(-4px); transition: transform 110ms ease; }
  </style>
</head>
<body>
  <h1 id="game-title">ğŸ§© å…ƒç´ é€±æœŸè¡¨æ»‘å¡Šæ‹¼åœ–ï¼ˆæ‰‹æ©Ÿï¼‰</h1>

  <div id="level-selection">
    <button class="level-btn" data-level="1">é—œå¡ä¸€</button>
    <button class="level-btn" data-level="2">é—œå¡äºŒ</button>
    <button class="level-btn" data-level="3">é—œå¡ä¸‰</button>
    <button class="level-btn" data-level="4">é—œå¡å››</button>
  </div>

  <div id="stats">
    <span id="moves">ç§»å‹•æ­¥æ•¸: 0</span>
    <span id="time" style="margin-left:12px;">èŠ±è²»æ™‚é–“: 00:00</span>
  </div>

  <div id="controls"><button id="toggleLangBtn">ğŸŒ åˆ‡æ›èªè¨€</button></div>

  <div id="holding-bay-container">
    <span>æš«å­˜å€:</span>
    <div id="holding-bay" class="cell empty" role="button" aria-label="æš«å­˜å€"></div>
  </div>

  <div id="table"></div>

  <script>
    // ========= è³‡æ–™èˆ‡è¨­å®š =========
    const allElements = [
      {cn:"æ°«", en:"H", row:1, col:1, type:"nonmetal"}, {cn:"æ°¦", en:"He", row:1, col:18, type:"noble"},
      {cn:"é‹°", en:"Li", row:2, col:1, type:"metal"}, {cn:"éˆ¹", en:"Be", row:2, col:2, type:"metal"},
      {cn:"ç¡¼", en:"B", row:2, col:13, type:"nonmetal"}, {cn:"ç¢³", en:"C", row:2, col:14, type:"nonmetal"},
      {cn:"æ°®", en:"N", row:2, col:15, type:"nonmetal"}, {cn:"æ°§", en:"O", row:2, col:16, type:"nonmetal"},
      {cn:"æ°Ÿ", en:"F", row:2, col:17, type:"nonmetal"}, {cn:"æ°–", en:"Ne", row:2, col:18, type:"noble"},
      {cn:"éˆ‰", en:"Na", row:3, col:1, type:"metal"}, {cn:"é‚", en:"Mg", row:3, col:2, type:"metal"},
      {cn:"é‹", en:"Al", row:3, col:13, type:"metal"}, {cn:"çŸ½", en:"Si", row:3, col:14, type:"nonmetal"},
      {cn:"ç£·", en:"P", row:3, col:15, type:"nonmetal"}, {cn:"ç¡«", en:"S", row:3, col:16, type:"nonmetal"},
      {cn:"æ°¯", en:"Cl", row:3, col:17, type:"nonmetal"}, {cn:"æ°¬", en:"Ar", row:3, col:18, type:"noble"},
      {cn:"é‰€", en:"K", row:4, col:1, type:"metal"}, {cn:"éˆ£", en:"Ca", row:4, col:2, type:"metal"},
      {cn:"éˆ§", en:"Sc", row:4, col:3, type:"transition"}, {cn:"éˆ¦", en:"Ti", row:4, col:4, type:"transition"},
      {cn:"é‡©", en:"V", row:4, col:5, type:"transition"}, {cn:"é‰»", en:"Cr", row:4, col:6, type:"transition"},
      {cn:"éŒ³", en:"Mn", row:4, col:7, type:"transition"}, {cn:"éµ", en:"Fe", row:4, col:8, type:"transition"},
      {cn:"éˆ·", en:"Co", row:4, col:9, type:"transition"}, {cn:"é³", en:"Ni", row:4, col:10, type:"transition"},
      {cn:"éŠ…", en:"Cu", row:4, col:11, type:"transition"}, {cn:"é‹…", en:"Zn", row:4, col:12, type:"transition"},
      {cn:"éµ", en:"Ga", row:4, col:13, type:"metal"}, {cn:"éº", en:"Ge", row:4, col:14, type:"nonmetal"},
      {cn:"ç ·", en:"As", row:4, col:15, type:"nonmetal"}, {cn:"ç¡’", en:"Se", row:4, col:16, type:"nonmetal"},
      {cn:"æº´", en:"Br", row:4, col:17, type:"nonmetal"}, {cn:"æ°ª", en:"Kr", row:4, col:18, type:"noble"},
    ];

    const levels = {
      1: { title: "é—œå¡ä¸€ï¼šå…ƒç´ æ–°æ˜Ÿ", filter: el => el.row <= 2 },
      2: { title: "é—œå¡äºŒï¼šä¸»æ—ç²¾é€š", filter: el => el.row <= 3 },
      3: { title: "é—œå¡ä¸‰ï¼šéæ¸¡é‡‘å±¬", filter: el => el.row === 4 },
      4: { title: "é—œå¡å››ï¼šçµ‚æ¥µæŒ‘æˆ°", filter: el => true }
    };

    const totalRows = 4, totalCols = 18;
    const tableEl = document.getElementById('table');
    const holdingBay = document.getElementById('holding-bay');

    let currentLang = 'cn';
    let moves = 0, seconds = 0, timerInterval = null;
    let isGameActive = false;
    let currentLevelElements = [];
    let holdingBayElement = null; // æš«å­˜å€å„²å­˜å…ƒç´ è³‡æ–™ (object or null)

    // è§¸æ§é˜²é‡èˆ‡æ»‘å‹•åˆ¤æ–·
    let lastTouchTime = 0;
    const TOUCH_CLICK_IGNORE_MS = 500;

    // ========= æ ¼å­æ¸²æŸ“èˆ‡è¿·éœ§åŠŸèƒ½ =========
    function renderCell(cell, elementData) {
      // å¦‚æœ cell æ˜¯ holding-bayï¼Œä¿æŒ class
      const hb = cell === holdingBay ? 'holding-bay' : '';
      cell.className = (`cell ${elementData.type} ${hb}`).trim();
      cell.classList.remove('covered');
      cell.textContent = (currentLang === 'cn') ? elementData.cn : elementData.en;
      cell.dataset.symbol = elementData.en;
      cell.dataset.cn = elementData.cn;
      cell.dataset.type = elementData.type;
      cell.draggable = true;
    }

    function clearCell(cell) {
      const hb = cell === holdingBay ? 'holding-bay' : '';
      cell.className = (`cell empty ${hb}`).trim();
      cell.classList.remove('covered');
      cell.textContent = '';
      delete cell.dataset.symbol;
      delete cell.dataset.cn;
      delete cell.dataset.type;
      cell.draggable = false;
    }

    // è¦†è“‹æ ¼å­ (è¿·éœ§)ï¼šé¡¯ç¤ºå•è™Ÿä¸¦åŠ ä¸Š covered é¡åˆ¥
    function coverCell(cell) {
      if (!cell) return;
      cell.classList.add('covered');
      cell.textContent = 'â“';
    }

    // åˆ¤æ–·æŸæ ¼å­æ”¾çš„å…ƒç´ æ˜¯å¦åœ¨æ­£ç¢ºä½ç½®
    function isCorrectPosition(cell, elementData) {
      if (!cell || !elementData) return false;
      const correct = allElements.find(e => e.en === elementData.en);
      if (!correct) return false;
      const idx = parseInt(cell.dataset.index, 10);
      const row = Math.floor(idx / totalCols) + 1;
      const col = (idx % totalCols) + 1;
      return correct.row === row && correct.col === col;
    }

    // æ‰¾åˆ°ä»»ä¸€ç©ºæ ¼ï¼ˆç›¤é¢ï¼‰
    function findAnyEmptyCell() {
      return tableEl.querySelector('.cell.empty:not(.disabled)');
    }

    // æ‰¾åˆ°ä¾†æº tile çš„é„°è¿‘ç©ºæ ¼ (ç”¨æ–¼é»æ“Šç§»å‹•)
    function findAdjacentEmptyForCell(sourceCell) {
      if (!sourceCell || sourceCell.classList.contains('empty')) return null;
      const fromIndex = parseInt(sourceCell.dataset.index, 10);
      const cells = Array.from(tableEl.querySelectorAll('.cell:not(.disabled)'));
      for (const c of cells) {
        const toIndex = parseInt(c.dataset.index, 10);
        if (c.classList.contains('empty') && isAdjacent(fromIndex, toIndex)) return c;
      }
      return null;
    }

    // ========= ç›¸é„°åˆ¤æ–·ï¼ˆå«ç‰¹æ®Šè·¨è¶Šè¦å‰‡ï¼‰ =========
    function isAdjacent(fromIndex, toIndex) {
      const fromRow = Math.floor(fromIndex / totalCols), fromCol = fromIndex % totalCols;
      const toRow = Math.floor(toIndex / totalCols), toCol = toIndex % totalCols;
      // ä¸Šä¸‹å·¦å³
      if (Math.abs(fromRow - toRow) + Math.abs(fromCol - toCol) === 1) return true;
      // è·¨è¶Šé´»æº
      if (fromRow === toRow) {
        if (fromRow === 0 && ((fromCol === 0 && toCol === 17) || (fromCol === 17 && toCol === 0))) return true; // H <-> He
        if ((fromRow === 1 || fromRow === 2) && ((fromCol === 1 && toCol === 12) || (fromCol === 12 && toCol === 1))) return true; // Be <-> B, Mg <-> Al
      }
      return false;
    }

    // ========= ç§»å‹•é‚è¼¯ï¼ˆé»æ“Š / æš«å­˜å€ / è¿·éœ§ï¼‰ =========
    // æŠŠç›¤é¢æ ¼å­ç§»åˆ°æš«å­˜å€
    function moveCellToHoldingBay(srcCell) {
      if (!holdingBay.classList.contains('empty')) return false;
      // ä¾†æºè³‡æ–™
      const data = { cn: srcCell.dataset.cn, en: srcCell.dataset.symbol, type: srcCell.dataset.type };
      if (!data.en) return false;
      holdingBayElement = { ...data };
      renderCell(holdingBay, holdingBayElement); // æš«å­˜å€ç¸½æ˜¯é¡¯ç¤ºçœŸå¯¦å…§å®¹
      clearCell(srcCell);
      incrementMoves();
      return true;
    }

    // æŠŠæš«å­˜å€å…ƒç´ æ”¾å›ç›¤é¢ç›®æ¨™æ ¼
    function moveHoldingBayToCell(targetCell) {
      if (!holdingBayElement) return false;
      if (!targetCell.classList.contains('empty')) return false;
      renderCell(targetCell, holdingBayElement);
      holdingBayElement = null;
      clearCell(holdingBay);
      // è¿·éœ§ï¼šè‹¥ä½ç½®ä¸æ­£ç¢ºï¼Œè“‹èµ·ä¾†
      if (!isCorrectPosition(targetCell, { en: targetCell.dataset.symbol })) {
        coverCell(targetCell);
      } else {
        targetCell.classList.add('correct-place-flash');
        setTimeout(()=> targetCell.classList.remove('correct-place-flash'), 480);
      }
      incrementMoves();
      checkWin();
      return true;
    }

    // ç›¤é¢ -> ç›¤é¢ å–®æ­¥ç§»å‹•
    function moveCellToCell(srcCell, targetCell) {
      if (!targetCell.classList.contains('empty')) return false;
      // æ‹·è²è³‡æ–™
      const data = { cn: srcCell.dataset.cn, en: srcCell.dataset.symbol, type: srcCell.dataset.type };
      if (!data.en) return false;
      renderCell(targetCell, data);
      clearCell(srcCell);
      // è¿·éœ§è™•ç†ï¼šè‹¥æ–°ä½ç½®ä¸æ­£ç¢ºï¼Œè“‹èµ·ä¾†
      if (!isCorrectPosition(targetCell, { en: data.en })) {
        coverCell(targetCell);
      } else {
        targetCell.classList.add('correct-place-flash');
        setTimeout(()=> targetCell.classList.remove('correct-place-flash'), 480);
      }
      incrementMoves();
      checkWin();
      return true;
    }

    // é»æ“Šæ ¼å­çš„ä¸»è¦è™•ç†ï¼ˆæ›¿ä»£æ‹–æ”¾ï¼‰
    function onCellClick(e) {
      const cell = e.currentTarget;
      if (cell.classList.contains('disabled')) return;
      // ç©ºæ ¼è¢«é»æ“Šï¼šè‹¥æš«å­˜å€æœ‰å…ƒç´  -> æ”¾å›
      if (cell.classList.contains('empty')) {
        if (holdingBayElement) moveHoldingBayToCell(cell);
        return;
      }
      // é»æ“Šæœ‰å…ƒç´ çš„æ ¼å­
      // 1) è©¦æ‰¾ç›¸é„°ç©ºæ ¼
      const adj = findAdjacentEmptyForCell(cell);
      if (adj) {
        moveCellToCell(cell, adj);
        return;
      }
      // 2) è‹¥æ²’æœ‰ç›¸é„°ç©ºæ ¼ä¸”ç›¤é¢å·²æ»¿ -> å˜—è©¦ç§»åˆ°æš«å­˜å€
      const anyEmpty = findAnyEmptyCell();
      if (!anyEmpty) {
        if (holdingBay.classList.contains('empty')) {
          moveCellToHoldingBay(cell);
          return;
        } else {
          flashCell(cell);
          return;
        }
      }
      // 3) ç›¤é¢æœ‰ç©ºæ ¼ä½†éç›¸é„° -> ä¸å…è¨±ç›´æ¥è·³ï¼ˆæç¤ºï¼‰
      flashCell(cell);
    }

    // æš«å­˜å€é»æ“Šï¼šæŠŠå…ƒç´ æ”¾å›ç¬¬ä¸€å€‹ç©ºæ ¼ï¼ˆæˆ–æç¤ºï¼‰
    function onHoldingBayClick(e) {
      if (!holdingBayElement) return;
      const target = findAnyEmptyCell();
      if (target) moveHoldingBayToCell(target);
      else flashCell(holdingBay);
    }

    function flashCell(cell) {
      cell.classList.add('touch-feedback');
      setTimeout(()=> cell.classList.remove('touch-feedback'), 140);
    }

    // ========= äº‹ä»¶ç¶å®šï¼šè™•ç† click + touch (é¿å…æ»‘å‹•æ™‚èª¤è§¸ç™¼) =========
    function setEvents(tile) {
      if (tile.classList.contains('disabled')) return;

      // click wrapper: è‹¥å‰›ç™¼ç”Ÿ touchï¼Œå¿½ç•¥çŸ­æ™‚å…§çš„ click
      function clickHandler(e) {
        if (Date.now() - lastTouchTime < TOUCH_CLICK_IGNORE_MS) return;
        onCellClick.call(this, e);
      }
      tile.addEventListener('click', clickHandler);

      // touch åˆ¤æ–·ï¼ˆå€åˆ†æ»‘å‹• vs tapï¼‰
      tile.addEventListener('touchstart', function(e){
        const t = e.touches && e.touches[0];
        if (t) {
          this._touchStartX = t.clientX;
          this._touchStartY = t.clientY;
          this._touchMoved = false;
        }
      }, { passive: true });

      tile.addEventListener('touchmove', function(e){
        const t = e.touches && e.touches[0];
        if (!t || this._touchStartX === undefined) return;
        const dx = Math.abs(t.clientX - this._touchStartX), dy = Math.abs(t.clientY - this._touchStartY);
        if (dx > 8 || dy > 8) this._touchMoved = true;
      }, { passive: true });

      tile.addEventListener('touchend', function(e){
        if (this._touchMoved) return; // æ˜¯æ»‘å‹•ï¼Œäº¤çµ¦ç€è¦½å™¨æ»¾å‹•
        lastTouchTime = Date.now();
        // ç›´æ¥å‘¼å«é»æ“Šè¡Œç‚ºï¼ˆclickHandler å·²æœƒå¿½ç•¥é‡è¤‡ï¼‰
        onCellClick.call(this, e);
      }, { passive: true });
    }

    // æš«å­˜å€ä¹Ÿç¶å®š touch/click
    holdingBay.addEventListener('click', function(e){
      if (Date.now() - lastTouchTime < TOUCH_CLICK_IGNORE_MS) return;
      onHoldingBayClick.call(this, e);
    });
    holdingBay.addEventListener('touchstart', function(e){
      const t = e.touches && e.touches[0];
      if (t) {
        this._touchStartX = t.clientX;
        this._touchStartY = t.clientY;
        this._touchMoved = false;
      }
    }, { passive: true });
    holdingBay.addEventListener('touchmove', function(e){
      const t = e.touches && e.touches[0];
      if (!t || this._touchStartX === undefined) return;
      const dx = Math.abs(t.clientX - this._touchStartX), dy = Math.abs(t.clientY - this._touchStartY);
      if (dx > 8 || dy > 8) this._touchMoved = true;
    }, { passive: true });
    holdingBay.addEventListener('touchend', function(e){
      if (this._touchMoved) return;
      lastTouchTime = Date.now();
      onHoldingBayClick.call(this, e);
    }, { passive: true });

    // ========= å»ºç«‹ç›¤é¢èˆ‡é—œå¡æµç¨‹ =========
    function createTable(elementOrder, levelConfig) {
      tableEl.innerHTML = '';
      const levelPositions = new Set(levelConfig.map(el => (el.row -1)*totalCols + (el.col -1)));
      // grid state by index
      const gridState = Array(totalRows * totalCols).fill(null);
      elementOrder.forEach(el => {
        const idx = (el.row -1)*totalCols + (el.col -1);
        gridState[idx] = el;
      });
      for (let i=0;i<gridState.length;i++){
        const div = document.createElement('div');
        div.classList.add('cell');
        div.dataset.index = i;
        if (!levelPositions.has(i)) {
          div.classList.add('disabled');
        } else {
          const el = gridState[i];
          if (el) renderCell(div, el);
          else clearCell(div);
          setEvents(div);
        }
        tableEl.appendChild(div);
      }
    }

    function startLevel(levelNum) {
      document.querySelectorAll('.level-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.level == levelNum));
      document.getElementById('game-title').textContent = levels[levelNum].title;
      currentLevelElements = allElements.filter(levels[levelNum].filter);

      // shuffle current level elements and map back to positions
      const shuffled = [...currentLevelElements].sort(()=> Math.random() - 0.5);
      const map = new Map();
      currentLevelElements.forEach((el, idx) => map.set((el.row -1)*totalCols + (el.col -1), shuffled[idx]));
      const boardSetup = [];
      currentLevelElements.forEach(el => {
        const originalIndex = (el.row -1)*totalCols + (el.col -1);
        const shuffledEl = map.get(originalIndex);
        boardSetup.push({ ...shuffledEl, row: el.row, col: el.col });
      });

      // reset holding bay
      clearCell(holdingBay);
      holdingBayElement = null;

      createTable(boardSetup, currentLevelElements);

      // è¿·éœ§ï¼šè¦†è“‹æ‰€æœ‰æ”¾åœ¨éŒ¯èª¤ä½ç½®çš„æ ¼å­
      const cells = tableEl.querySelectorAll('.cell:not(.disabled):not(.empty)');
      cells.forEach(cell => {
        const data = { en: cell.dataset.symbol, cn: cell.dataset.cn };
        if (!isCorrectPosition(cell, data)) {
          coverCell(cell);
        }
      });

      startTimerAndCounter();
    }

    // ========= å‹åˆ©æª¢æŸ¥ç­‰ =========
    function checkWin() {
      if (holdingBayElement) return; // æš«å­˜å€å¿…é ˆç©º
      const placed = [...tableEl.querySelectorAll('.cell:not(.empty):not(.disabled)')];
      if (placed.length !== currentLevelElements.length) return;
      const ok = placed.every(cell => {
        const el = allElements.find(e => e.en === cell.dataset.symbol);
        const idx = parseInt(cell.dataset.index, 10);
        const row = Math.floor(idx/totalCols) + 1;
        const col = (idx % totalCols) + 1;
        return el && el.row === row && el.col === col;
      });
      if (ok) {
        stopGame();
        placed.forEach(c=> c.classList.add('win-flash'));
        setTimeout(()=> {
          alert(`ğŸ¯ æ­å–œå®Œæˆï¼\n${document.getElementById('game-title').textContent}\nèŠ±è²»æ™‚é–“: ${document.getElementById('time').textContent}\nç§»å‹•æ­¥æ•¸: ${moves}`);
          init();
        }, 480);
      }
    }

    // ========= éŠæˆ²åˆå§‹åŒ– / è¨ˆæ™‚ =========
    function init() {
      stopGame();
      isGameActive = false;
      holdingBayElement = null;
      document.getElementById('game-title').textContent = 'ğŸ§© å…ƒç´ é€±æœŸè¡¨æ»‘å¡Šæ‹¼åœ–ï¼ˆæ‰‹æ©Ÿï¼‰';
      moves = 0; seconds = 0;
      document.getElementById('moves').textContent = 'ç§»å‹•æ­¥æ•¸: 0';
      document.getElementById('time').textContent = 'èŠ±è²»æ™‚é–“: 00:00';
      document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
      clearCell(holdingBay);
      createTable([], allElements); // é¡¯ç¤ºä¸€å€‹å…¨é–å®šçš„ç©ºç›¤é¢
    }

    function startTimerAndCounter() {
      isGameActive = true;
      moves = 0; seconds = 0;
      document.getElementById('moves').textContent = `ç§»å‹•æ­¥æ•¸: ${moves}`;
      clearInterval(timerInterval);
      timerInterval = setInterval(()=> { seconds++; updateTime(); }, 1000);
      updateTime();
    }
    function stopGame() { isGameActive = false; clearInterval(timerInterval); }
    function incrementMoves(){ moves += 1; document.getElementById('moves').textContent = `ç§»å‹•æ­¥æ•¸: ${moves}`; }
    function updateTime() {
      const mins = Math.floor(seconds/60).toString().padStart(2,'0');
      const secs = (seconds%60).toString().padStart(2,'0');
      document.getElementById('time').textContent = `èŠ±è²»æ™‚é–“: ${mins}:${secs}`;
    }

    // ========= èªè¨€åˆ‡æ›ï¼ˆæ³¨æ„ï¼šä¸è¦è®Šæ›´è¢«è¦†è“‹çš„æ ¼å­ï¼‰ =========
    document.getElementById('toggleLangBtn').addEventListener('click', () => {
      currentLang = (currentLang === 'cn') ? 'en' : 'cn';
      // æ›´æ–°æœªè¢«è¦†è“‹çš„æ ¼å­èˆ‡æš«å­˜å€
      document.querySelectorAll('.cell').forEach(cell => {
        if (!cell.classList.contains('empty') && !cell.classList.contains('disabled') && cell.dataset.cn && !cell.classList.contains('covered')) {
          cell.textContent = (currentLang === 'cn') ? cell.dataset.cn : cell.dataset.symbol;
        }
      });
      if (holdingBayElement) {
        holdingBay.textContent = (currentLang === 'cn') ? holdingBayElement.cn : holdingBayElement.en;
      }
    });

    // é—œå¡æŒ‰éˆ•
    document.querySelectorAll('.level-btn').forEach(btn => btn.addEventListener('click', () => startLevel(btn.dataset.level)));

    // æš«å­˜å€é»æ“Šäº‹ä»¶å·²ç¶ï¼ˆä¸Šæ–¹ï¼‰ï¼Œåˆå§‹åŒ–
    init();
  </script>
</body>
</html>
