<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…ƒç´ é€±æœŸè¡¨æ»‘å¡Šæ‹¼åœ– (æœ€çµ‚ç©©å®šç‰ˆ)</title>
<style>
  body {
    font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
    background: #f5f7fa;
    text-align: center;
    color: #1f2937;
    touch-action: none; /* é˜²æ­¢è§¸æ§æ»‘å‹•æ™‚é é¢èƒŒæ™¯æ»¾å‹• */
  }
  h1 { margin-top: 20px; font-size: 1.5em; }
  #level-selection { margin: 15px 0; }
  .level-btn { padding: 10px 16px; font-size: 1em; cursor: pointer; border: 2px solid transparent; background-color: #6d28d9; color: white; border-radius: 6px; margin: 0 5px; transition: all 0.2s; }
  .level-btn:hover { background-color: #5b21b6; }
  .level-btn.active { background-color: #f5f7fa; color: #6d28d9; border-color: #6d28d9; font-weight: bold; }
  #stats { margin: 15px; font-size: 1.1em; font-weight: bold; color: #374151; }
  #stats span { margin: 0 10px; min-width: 100px; display: inline-block; }
  #controls { margin-top: 10px; }
  #toggleLangBtn { padding: 8px 14px; font-size: 1em; cursor: pointer; border: none; background-color: #4f46e5; color: white; border-radius: 6px; }
  #holding-bay-container { margin: 15px auto; padding: 10px; background: #e5e7eb; border-radius: 8px; display: flex; align-items: center; justify-content: center; width: 200px; }
  #holding-bay-container span { font-weight: bold; margin-right: 10px; }
  #holding-bay { width: 50px; height: 50px; border: 2px dashed #9ca3af; }
  #table { display: grid; grid-template-columns: repeat(18, 48px); grid-template-rows: repeat(4, 48px); gap: 2px; justify-content: center; margin: 10px auto; padding: 5px; border: 2px solid #d1d5db; border-radius: 8px; background-color: #e5e7eb; max-width: 95vw; overflow-x: auto; }
  .cell { display: flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: bold; user-select: none; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  .cell[draggable="true"]:hover { transform: scale(1.05); cursor: pointer; }
  .empty { background: #e2e8f0; box-shadow: inset 0 2px 4px rgba(0,0,0,0.06); }
  .disabled { background-color: #cbd5e1; cursor: not-allowed; box-shadow: none; }
  .metal { background: #c7f9cc; } .nonmetal { background: #fef08a; } .noble { background: #a5f3fc; } .transition { background: #fca5a5; }
  .drag-over { outline: 2px dashed #6366f1; transform: scale(1.05); }
  .win-flash { animation: flash 0.5s ease-in-out; }
  @keyframes flash { 0% { box-shadow: 0 0 15px #fef08a; transform: scale(1.05); } 100% { box-shadow: 0 1px 3px rgba(0,0,0,0.1); transform: scale(1); } }
</style>
</head>
<body>
  <h1 id="game-title">ğŸ§© å…ƒç´ é€±æœŸè¡¨æ»‘å¡Šæ‹¼åœ–</h1>
  <div id="level-selection">
    <button class="level-btn" data-level="1">é—œå¡ä¸€</button>
    <button class="level-btn" data-level="2">é—œå¡äºŒ</button>
    <button class="level-btn" data-level="3">é—œå¡ä¸‰</button>
    <button class="level-btn" data-level="4">é—œå¡å››</button>
  </div>
  <div id="stats">
    <span id="moves">ç§»å‹•æ­¥æ•¸: 0</span>
    <span id="time">èŠ±è²»æ™‚é–“: 00:00</span>
  </div>
  <div id="controls"><button id="toggleLangBtn">ğŸŒ åˆ‡æ›èªè¨€</button></div>
  <div id="holding-bay-container"><span>æš«å­˜å€:</span><div id="holding-bay" class="cell empty"></div></div>
  <div id="table"></div>

  <script>
    const allElements = [
      {cn:"æ°«", en:"H", row:1, col:1, type:"nonmetal"}, {cn:"æ°¦", en:"He", row:1, col:18, type:"noble"},
      {cn:"é‹°", en:"Li", row:2, col:1, type:"metal"}, {cn:"éˆ¹", en:"Be", row:2, col:2, type:"metal"},
      {cn:"ç¡¼", en:"B", row:2, col:13, type:"nonmetal"}, {cn:"ç¢³", en:"C", row:2, col:14, type:"nonmetal"},
      {cn:"æ°®", en:"N", row:2, col:15, type:"nonmetal"}, {cn:"æ°§", en:"O", row:2, col:16, type:"nonmetal"},
      {cn:"æ°Ÿ", en:"F", row:2, col:17, type:"nonmetal"}, {cn:"æ°–", en:"Ne", row:2, col:18, type:"noble"},
      {cn:"éˆ‰", en:"Na", row:3, col:1, type:"metal"}, {cn:"é‚", en:"Mg", row:3, col:2, type:"metal"},
      {cn:"é‹", en:"Al", row:3, col:13, type:"metal"}, {cn:"çŸ½", en:"Si", row:3, col:14, type:"nonmetal"},
      {cn:"ç£·", en:"P", row:3, col:15, type:"nonmetal"}, {cn:"ç¡«", en:"S", row:3, col:16, type:"nonmetal"},
      {cn:"æ°¯", en:"Cl", row:3, col:17, type:"nonmetal"}, {cn:"æ°¬", en:"Ar", row:3, col:18, type:"noble"},
      {cn:"é‰€", en:"K", row:4, col:1, type:"metal"}, {cn:"éˆ£", en:"Ca", row:4, col:2, type:"metal"},
      {cn:"éˆ§", en:"Sc", row:4, col:3, type:"transition"}, {cn:"éˆ¦", en:"Ti", row:4, col:4, type:"transition"},
      {cn:"é‡©", en:"V", row:4, col:5, type:"transition"}, {cn:"é‰»", en:"Cr", row:4, col:6, type:"transition"},
      {cn:"éŒ³", en:"Mn", row:4, col:7, type:"transition"}, {cn:"éµ", en:"Fe", row:4, col:8, type:"transition"},
      {cn:"éˆ·", en:"Co", row:4, col:9, type:"transition"}, {cn:"é³", en:"Ni", row:4, col:10, type:"transition"},
      {cn:"éŠ…", en:"Cu", row:4, col:11, type:"transition"}, {cn:"é‹…", en:"Zn", row:4, col:12, type:"transition"},
      {cn:"éµ", en:"Ga", row:4, col:13, type:"metal"}, {cn:"éº", en:"Ge", row:4, col:14, type:"nonmetal"},
      {cn:"ç ·", en:"As", row:4, col:15, type:"nonmetal"}, {cn:"ç¡’", en:"Se", row:4, col:16, type:"nonmetal"},
      {cn:"æº´", en:"Br", row:4, col:17, type:"nonmetal"}, {cn:"æ°ª", en:"Kr", row:4, col:18, type:"noble"},
    ];

    const levels = {
        1: { title: "é—œå¡ä¸€ï¼šå…ƒç´ æ–°æ˜Ÿ", filter: el => el.row <= 2 },
        2: { title: "é—œå¡äºŒï¼šä¸»æ—ç²¾é€š", filter: el => el.row <= 3 },
        3: { title: "é—œå¡ä¸‰ï¼šéæ¸¡é‡‘å±¬", filter: el => el.row === 4 },
        4: { title: "é—œå¡å››ï¼šçµ‚æ¥µæŒ‘æˆ°", filter: el => true }
    };

    const totalRows = 4, totalCols = 18;
    const table = document.getElementById("table");
    const holdingBay = document.getElementById("holding-bay");
    
    let currentLang = "cn", moves = 0, seconds = 0;
    let timerInterval = null, isGameActive = false;
    let currentLevelElements = [];
    let holdingBayElement = null; // è¿½è¹¤æš«å­˜å€çš„å…ƒç´ è³‡æ–™

    let draggedElement = null; // **ç”¨æ–¼è§¸æ§äº‹ä»¶ï¼šè¨˜éŒ„ç•¶å‰è¢«æ‹–æ›³çš„ DOM å…ƒç´ **
    let lastOverElement = null; // **ç”¨æ–¼è§¸æ§äº‹ä»¶ï¼šè¨˜éŒ„ä¸Šæ¬¡æ‰‹æŒ‡æ‡¸åœçš„ DOM å…ƒç´ **

    // åˆ¤æ–·æ˜¯å¦ç›¸é„° (åŒ…å«è·¨è¶Šè¦å‰‡)
    function isAdjacent(fromIndex, toIndex) {
        const fromRow = Math.floor(fromIndex / totalCols), fromCol = fromIndex % totalCols;
        const toRow = Math.floor(toIndex / totalCols), toCol = toIndex % totalCols;

        // è¦å‰‡1: ä¸Šä¸‹å·¦å³ç›¸é„°
        if (Math.abs(fromRow - toRow) + Math.abs(fromCol - toCol) === 1) {
            return true;
        }
        // è¦å‰‡2: è·¨è¶Šé´»æº (åŒæ©«åˆ—)
        if (fromRow === toRow) {
            if (fromRow === 0 && ((fromCol === 0 && toCol === 17) || (fromCol === 17 && toCol === 0))) { // H <-> He
                return true;
            }
            if ((fromRow === 1 || fromRow === 2) && ((fromCol === 1 && toCol === 12) || (fromCol === 12 && toCol === 1))) { // Be <-> B, Mg <-> Al
                return true;
            }
        }
        return false;
    }

    // æ¸²æŸ“æˆ–æ›´æ–°ä¸€å€‹æ ¼å­
    function renderCell(cell, elementData) {
        cell.className = `cell ${elementData.type}`;
        cell.textContent = (currentLang === "cn") ? elementData.cn : elementData.en;
        cell.dataset.symbol = elementData.en;
        cell.dataset.cn = elementData.cn;
        cell.draggable = true;
    }

    // æ¸…ç©ºä¸€å€‹æ ¼å­
    function clearCell(cell) {
        cell.className = 'cell empty';
        cell.textContent = '';
        cell.dataset.symbol = '';
        cell.dataset.cn = '';
        cell.draggable = false;
    }

    // è™•ç†å¯¦éš›çš„å…ƒç´ ç§»å‹•é‚è¼¯
    function handleMove(sourceElement, targetElement) {
        const sourceIsBay = sourceElement.id === 'holding-bay';
        const targetIsBay = targetElement.id === 'holding-bay';

        // å¿…é ˆç›®æ¨™æ˜¯ç©ºçš„æ‰èƒ½ç§»å‹•
        if (!targetElement.classList.contains('empty')) return;

        // æƒ…æ³1: å¾ç›¤é¢ç§»å‹•åˆ°æš«å­˜å€
        if (!sourceIsBay && targetIsBay) {
            if (holdingBayElement) return; // æš«å­˜å€å¿…é ˆæ˜¯ç©ºçš„

            holdingBayElement = { 
                cn: sourceElement.dataset.cn, 
                en: sourceElement.dataset.symbol, 
                type: sourceElement.className.split(' ')[1] 
            };
            renderCell(holdingBay, holdingBayElement); // æš«å­˜å€é¡¯ç¤ºå…ƒç´ 
            clearCell(sourceElement); // ç›¤é¢ä¾†æºæ¸…ç©º
            updateMoves();
        }
        // æƒ…æ³2: å¾æš«å­˜å€ç§»å‹•åˆ°ç›¤é¢
        else if (sourceIsBay && !targetIsBay) {
            if (!holdingBayElement) return; // æš«å­˜å€å¿…é ˆæœ‰å…ƒç´ 

            renderCell(targetElement, holdingBayElement); // ç›¤é¢ç›®æ¨™é¡¯ç¤ºå…ƒç´ 
            clearCell(holdingBay); // æš«å­˜å€æ¸…ç©º
            holdingBayElement = null;
            updateMoves();
            checkWin(); // æ¯æ¬¡ç›¤é¢å¡«æ»¿éƒ½æœ‰æ©Ÿæœƒç²å‹
        }
        // æƒ…æ³3: å¾ç›¤é¢ç§»å‹•åˆ°ç›¤é¢ (æ»‘å‹•)
        else if (!sourceIsBay && !targetIsBay) {
            const fromIndex = parseInt(sourceElement.dataset.index, 10);
            const toIndex = parseInt(targetElement.dataset.index, 10);

            if (isAdjacent(fromIndex, toIndex)) { // æª¢æŸ¥æ˜¯å¦ç›¸é„° (åŒ…å«è·¨è¶Š)
                const fromData = { 
                    cn: sourceElement.dataset.cn, 
                    en: sourceElement.dataset.symbol, 
                    type: sourceElement.className.split(' ')[1] 
                };
                renderCell(targetElement, fromData); // ç›®æ¨™é¡¯ç¤ºå…ƒç´ 
                clearCell(sourceElement); // ä¾†æºæ¸…ç©º
                updateMoves();
                checkWin();
            }
        }
    }

    // ç‚ºå–®å€‹æ ¼å­è¨­ç½®æ‰€æœ‰äº‹ä»¶ç›£è½å™¨ (æ»‘é¼ æ‹–æ”¾ + è§¸æ§æ‹–æ”¾)
    function setEvents(tile) {
        // --- é€šç”¨æ‹–æ›³é–‹å§‹é‚è¼¯ ---
        const commonDragStart = (e) => {
            if (!isGameActive || tile.classList.contains("empty") || tile.classList.contains("disabled")) {
                e.preventDefault(); // é˜»æ­¢ç„¡æ•ˆçš„æ‹–æ›³
                return false;
            }
            return true; // å…è¨±æ‹–æ›³
        };

        // --- æ»‘é¼ æ‹–æ”¾äº‹ä»¶ (é›»è…¦ç‰ˆ) ---
        tile.addEventListener("dragstart", e => {
            if (commonDragStart(e)) {
                const sourceId = tile.id === 'holding-bay' ? 'holding-bay' : tile.dataset.index;
                e.dataTransfer.setData("text/plain", sourceId);
            }
        });
        tile.addEventListener("dragover", e => {
            e.preventDefault();
            if (e.target.classList.contains("empty")) e.target.classList.add("drag-over");
        });
        tile.addEventListener("dragleave", e => {
            e.target.classList.remove("drag-over");
        });
        tile.addEventListener("drop", e => {
            e.preventDefault();
            e.target.classList.remove("drag-over");
            const sourceIndex = e.dataTransfer.getData("text/plain");
            const sourceElement = sourceIndex === 'holding-bay' ? holdingBay : document.querySelector(`[data-index='${sourceIndex}']`);
            
            if (sourceElement) {
                handleMove(sourceElement, e.target);
            }
        });

        // --- æ‰‹æ©Ÿè§¸æ§äº‹ä»¶ ---
        tile.addEventListener("touchstart", e => {
            if (!commonDragStart(e)) return;
            draggedElement = tile; // è¨˜éŒ„è¢«æ‹–æ›³çš„å…ƒç´ 
            // å¯ä»¥é¸æ“‡åœ¨æ­¤è™•çµ¦ draggedElement ä¸€å€‹è¦–è¦ºä¸Šçš„åé¥‹ï¼Œä¾‹å¦‚åŠ å€‹ class
            // draggedElement.classList.add('is-dragging');
        }, { passive: false }); // { passive: false } å…è¨±é˜»æ­¢é è¨­è¡Œç‚º (å¦‚é é¢æ»¾å‹•)

        tile.addEventListener("touchmove", e => {
            e.preventDefault(); // é˜»æ­¢é é¢æ»¾å‹•
            if (!draggedElement) return;

            const touch = e.touches[0];
            const overElement = document.elementFromPoint(touch.clientX, touch.clientY);

            if (lastOverElement && lastOverElement !== overElement) {
                lastOverElement.classList.remove("drag-over");
            }
            if (overElement && overElement.classList.contains("empty") && overElement !== draggedElement) {
                overElement.classList.add("drag-over");
                lastOverElement = overElement;
            } else if (overElement && !overElement.classList.contains("empty")) {
                // å¦‚æœæ‰‹æŒ‡ç§»åˆ°äº†éç©ºçš„æ ¼å­ï¼Œä¹Ÿè¦æ¸…é™¤ drag-over æ•ˆæœ
                if(lastOverElement) lastOverElement.classList.remove("drag-over");
                lastOverElement = null; // é‡ç½®
            }
        }, { passive: false });

        tile.addEventListener("touchend", e => {
            if (!draggedElement) return;

            if (lastOverElement && lastOverElement.classList.contains("empty")) {
                handleMove(draggedElement, lastOverElement);
            }
            
            if (lastOverElement) lastOverElement.classList.remove("drag-over");
            // if (draggedElement) draggedElement.classList.remove('is-dragging');
            draggedElement = null;
            lastOverElement = null;
        });
    }

    // å‰µå»ºæˆ–æ›´æ–°éŠæˆ²ç›¤é¢
    function createTable(elementOrder, levelConfig) {
        table.innerHTML = "";
        const levelPositions = new Set(levelConfig.map(el => (el.row - 1) * totalCols + (el.col - 1)));
        
        // ä½¿ç”¨ä¸€å€‹é™£åˆ—ä¾†è¡¨ç¤ºç›¤é¢çš„ç•¶å‰ç‹€æ…‹
        const gridState = Array(totalRows * totalCols).fill(null);
        elementOrder.forEach(el => {
            const index = (el.row - 1) * totalCols + (el.col - 1);
            gridState[index] = el;
        });

        for (let i = 0; i < gridState.length; i++) {
            const div = document.createElement("div");
            div.classList.add("cell");
            div.dataset.index = i;

            if (!levelPositions.has(i)) { // ä¸å±¬æ–¼ç•¶å‰é—œå¡çš„æ ¼å­
                div.classList.add("disabled");
            } else {
                const el = gridState[i];
                if (el) { // å¦‚æœæœ‰å…ƒç´ 
                    renderCell(div, el);
                } else { // å¦‚æœæ˜¯ç©ºæ ¼ (é€™åœ¨åˆå§‹ç‹€æ…‹æ‡‰è©²ä¸æœƒç™¼ç”Ÿï¼Œåªæœ‰æš«å­˜å€å–å‡ºå¾Œæ‰æœƒæœ‰)
                    clearCell(div);
                }
                setEvents(div); // ç‚ºæ¯å€‹å¯äº’å‹•çš„æ ¼å­è¨­ç½®äº‹ä»¶
            }
            table.appendChild(div);
        }
    }
    
    // éŠæˆ²é–‹å§‹æ™‚çš„åˆå§‹åŒ–ï¼Œæ‰“äº‚å…ƒç´ 
    function startLevel(levelNum) {
        // æ›´æ–°é—œå¡æŒ‰éˆ•æ¨£å¼å’Œæ¨™é¡Œ
        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.level == levelNum);
        });
        document.getElementById("game-title").textContent = levels[levelNum].title;
        
        // ç¯©é¸å‡ºç•¶å‰é—œå¡çš„å…ƒç´ 
        currentLevelElements = allElements.filter(levels[levelNum].filter);

        // æ‰“äº‚å…ƒç´ ä¸¦å‰µå»ºåˆå§‹ç›¤é¢
        // é€™è£¡çš„é‚è¼¯æ˜¯ç›´æ¥å°‡ç•¶å‰é—œå¡çš„æ‰€æœ‰å…ƒç´ æ‰“äº‚ï¼Œç„¶å¾ŒæŒ‰ç…§å®ƒå€‘åœ¨é€±æœŸè¡¨ä¸­çš„æ­£ç¢ºä½ç½®é‡æ–°åˆ†é…
        // é€™æ¨£å°±ä¸æœƒæœ‰ã€Œç¼ºå°‘å…ƒç´ ã€çš„å•é¡Œï¼Œé™¤éç©å®¶æŠŠå…ƒç´ æ‹–åˆ°æš«å­˜å€
        let shuffledElements = [...currentLevelElements].sort(() => Math.random() - 0.5);
        let boardSetup = [];
        
        // å°‡æ‰“äº‚å¾Œçš„å…ƒç´ ï¼ŒæŒ‰ç…§å®ƒå€‘åœ¨ç•¶å‰é—œå¡ä¸­çš„"æ­£ç¢º"ä½ç½®æ”¾å›å»
        // (æ­¤æ™‚ä½ç½®æ˜¯è¢«æ‰“äº‚çš„ï¼Œä½†ç¢ºä¿æ¯å€‹ä½ç½®éƒ½æœ‰ä¸€å€‹å…ƒç´ )
        const elementMap = new Map(); // ç”¨ä¾†å°‡æ‰“äº‚å¾Œçš„å…ƒç´ èˆ‡å…¶åŸå§‹ä½ç½®å°æ‡‰
        currentLevelElements.forEach((el, index) => {
            elementMap.set((el.row - 1) * totalCols + (el.col - 1), shuffledElements[index]);
        });

        // æ§‹é€ ä¸€å€‹è¡¨ç¤ºç›¤é¢æœ€çµ‚ç‹€æ…‹çš„é™£åˆ—ï¼Œæ¯å€‹å…ƒç´ éƒ½å¸¶æœ‰å…¶æ‰“äº‚å¾Œçš„ä½ç½®
        currentLevelElements.forEach(el => {
            const originalIndex = (el.row - 1) * totalCols + (el.col - 1);
            const shuffledEl = elementMap.get(originalIndex);
            boardSetup.push({ ...shuffledEl, row: el.row, col: el.col });
        });

        // æ¸…ç©ºæš«å­˜å€ä¸¦å‰µå»ºç›¤é¢
        clearCell(holdingBay);
        holdingBayElement = null;
        createTable(boardSetup, currentLevelElements);
        
        startTimerAndCounter();
    }
    
    // æª¢æŸ¥éŠæˆ²æ˜¯å¦å‹åˆ©
    function checkWin() {
        if (holdingBayElement) return; // æš«å­˜å€å¿…é ˆæ˜¯ç©ºçš„æ‰ç®—å‹åˆ©

        const cells = [...table.querySelectorAll(".cell:not(.empty):not(.disabled)")];
        if (cells.length !== currentLevelElements.length) return; // ç›¤é¢å…ƒç´ æ•¸é‡å¿…é ˆç­‰æ–¼é—œå¡ç¸½æ•¸

        const isCorrect = cells.every(cell => {
            const el = allElements.find(e => e.en === cell.dataset.symbol); // æ‰¾åˆ°è©²æ ¼å­çš„æ­£ç¢ºå…ƒç´ è³‡æ–™
            const idx = parseInt(cell.dataset.index, 10);
            const row = Math.floor(idx / totalCols) + 1;
            const col = (idx % totalCols) + 1;
            return el && el.row === row && el.col === col; // æª¢æŸ¥å…ƒç´ æ˜¯å¦åœ¨æ­£ç¢ºä½ç½®
        });

        if (isCorrect) {
            stopGame();
            // å‹åˆ©å‹•ç•«æ•ˆæœ
            cells.forEach(cell => cell.classList.add('win-flash'));
            setTimeout(() => {
                alert(`ğŸ¯ æ­å–œå®Œæˆï¼\n\n${document.getElementById("game-title").textContent}\nèŠ±è²»æ™‚é–“: ${document.getElementById("time").textContent.split(': ')[1]}\nç§»å‹•æ­¥æ•¸: ${moves-1}`);
                init();
            }, 500); // å»¶é²é¡¯ç¤ºè¨Šæ¯ï¼Œè®“å‹•ç•«æœ‰æ™‚é–“æ’­æ”¾
        }
    }
    
    // éŠæˆ²åˆå§‹åŒ–/é‡ç½®
    function init() {
        stopGame();
        isGameActive = false;
        holdingBayElement = null;
        document.getElementById("game-title").textContent = 'ğŸ§© å…ƒç´ é€±æœŸè¡¨æ»‘å¡Šæ‹¼åœ–';
        document.getElementById("moves").textContent = 'ç§»å‹•æ­¥æ•¸: 0';
        document.getElementById("time").textContent = 'èŠ±è²»æ™‚é–“: 00:00';
        document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
        clearCell(holdingBay);
        createTable([], allElements); // é¡¯ç¤ºä¸€å€‹å…¨é–å®šçš„ç©ºç›¤é¢
    }

    // --- å…¶ä»–è¼”åŠ©å‡½æ•¸ ---
    function startTimerAndCounter() {
        isGameActive = true; moves = 0; seconds = 0;
        updateMoves();
        clearInterval(timerInterval);
        timerInterval = setInterval(() => { seconds++; updateTime(); }, 1000);
        updateTime();
    }
    function stopGame() { isGameActive = false; clearInterval(timerInterval); }
    function updateMoves() { document.getElementById("moves").textContent = `ç§»å‹•æ­¥æ•¸: ${moves++}`; }
    function updateTime() {
        const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
        const secs = (seconds % 60).toString().padStart(2, '0');
        document.getElementById("time").textContent = `èŠ±è²»æ™‚é–“: ${mins}:${secs}`;
    }
    document.getElementById("toggleLangBtn").addEventListener("click", () => {
      currentLang = (currentLang === "cn") ? "en" : "cn";
      document.querySelectorAll(".cell, #holding-bay").forEach(cell => {
        if (!cell.classList.contains("empty") && !cell.classList.contains("disabled") && cell.dataset.cn) {
          cell.textContent = (currentLang === "cn") ? cell.dataset.cn : cell.dataset.symbol;
        }
      });
    });
    document.querySelectorAll('.level-btn').forEach(button => {
        button.addEventListener("click", () => startLevel(button.dataset.level));
    });

    // ç‚ºæš«å­˜å€è¨­ç½®äº‹ä»¶
    setEvents(holdingBay);
    // åˆå§‹åŒ–éŠæˆ²
    init();
  </script>
</body>
</html>